---
title: 区块链系列文章（3） - 比特币白皮书解读（Part1）
show_author_profile: true
tags: Web3
key: web3-3
---

2008年，中本聪发表了白皮书《Bitcoin: A Peer-to-Peer Electronic Cash System》，正式标志着区块链技术的问世。

这篇论文虽然只有9页，但是含金量满满，也是我近几年读的最艰深也最过瘾的论文了，趁这次机会重读这篇论文，和大家一起了解中本聪设计比特币的初衷，和系统背后的原理。

有意思的是，至今为止，中本聪的身份还是个谜，又或许中本聪只是一个团队的代号。但有一点毋庸置疑，正是因为中本聪的这篇创世论文，才使得区块链技术应用真正得以实现，从这一点上来说，中本聪值得一个诺贝尔奖经济学奖。

<!--more-->

## 1.简介

在论文的简介中，中本聪提到，传统的线上交易必须依赖可信任第三方中介系统，为交易风险做担保。另外，由于商家和顾客存在各种纠纷，交易是做不到不可撤销的，比如商家经常会因为顾客的投诉而不得不退款，而商家为了加深对客户的信任，就只能要求他们提供更多的个人信息，来防止欺诈。

而在所有交易形式中，只有现金具有不可逆性，所以有些商家为了保护自己会采取现金交易的方式，这也是为什么比特币是一种电子现金系统，而不只是电子货币。

中本聪认为，我们应该建立一个电子交易系统，完全通过密码学来解决信任问题，任何人都可以在不需要第三方机构的情况下进行交易。既然是去中心化的系统，每个节点都可以验证交易，只要诚实节点的算力总和大于攻击节点的算力，那么这个系统就是安全的。

同时，比特币系统还可以解决双重支付问题（Double Spending）。双重支付问题简单来说就是一笔钱支付给了多个人，这在现金交易中是不存在的，因为同一笔现金，不可能同时给多个人，但在电子支付中，交易金额只是数字，可以同时转给多个人。比特币系统可以通过工作量证明、广播等机制来解决双重支付问题。


总结下来，比特币系统有3个主要特点：

1. 用密码学代替信用
2. 去中心化的点对点支付，无需第三方机构，提高效率
3. 不可逆

## 2. 交易

在这一章节里，中本聪介绍了比特币系统中的交易和记账体系概念。


比特币的记账体系和我们熟知的银行交易体系是完全不同的。在银行系统中，一个账户会包含很多交易，账户的余额等于收入减去支出，当A转给B100块，A的账户会减少100，B的账户会增加100。而比特币系统采用的是UTXO模型，全称Unspending Transaction Outoput，也叫未花费交易支出，每笔交易都会记录上一笔交易的哈希值，收款方和付款方侧信息，交易金额。

以下面的比特币交易为例，在交易2中，Alice要转给Bob17个比特币，按照比特币系统的逻辑，Alice首先要把所有的25个比特币全部交易出去，其中17个转给了Bob，剩余的8个比特币转给了Alice自己的账户，交易成功后，Bob拥有了Alice在交易1中所转的17个比特币。当Bob在交易3中给Charlie8个比特币，节点就可以根据Bob的上一笔交易来验证Bob是否真的有8个比特币。UTXO模型的好处在于，当系统的交易量很大的时候，节点不需要统计账户所有历史的交易来验证该账户的余额，大大提高了节点验证交易的效率和速度。

![UTXO](https://github.com/darcy-fzh/darcy-fzh.github.io/raw/master/screenshots/UTXO.png)


“我们定义一枚电子货币就是一条数字签名链。每个拥有者都通过将上一次交易和下一个拥有者的公钥的哈希值的数字签名添加到此货币末尾的方式将这枚货币转移给下一个拥有者。收款人可以通过验证数字签名来证实其为该链的所有者。”

![交易体系](https://github.com/darcy-fzh/darcy-fzh.github.io/raw/master/screenshots/交易体系.png)

中本聪在论文中没有用文字来详细解释UTXO模型，而是用配图简练概括了比特币系统的记账体系，我们在此可以稍微展开。配图是由一笔笔交易组成的有向链式结构，交易1会加上所有者2的公钥一同进行哈希，同时，所有者1会用自己的私钥来进行数字签名，其他人可以用所有者1发布的公钥进行验证，后面的交易以此内推。

公钥、私钥和数字签名这些不是中本聪首创的概念，而是来自于非对称加密算法。比特币采用椭圆曲线算法生成一对公钥和私钥，公钥顾名思义是可以公开给他人的，用来验证所有权，私钥只有持币者才能拥有，用来进行数字签名，确保这笔交易确实是由转账者发出去的。便于理解，我们可以把公钥理解为银行卡卡号，在比特币系统中对应每个钱包的地址，私钥可以理解为密码。

正如简介中所说，比特币系统是通过密码学技术来彻底取代信用，收款人可以通过数字签名技术验证付款方的身份以及判断交易是否被篡改，但是还不能解决双重支付问题，即付款方是否将同一个比特币转给多个人。要解决双重支付的问题，一种方式是引入一个第三方中介结构来检查这笔交易，但这样就违背了去中心化的初衷，所以中本聪提到了另一个方法，那就是每当付款人提交了一笔交易，就会向全网广播这笔交易，这样，收款人可以知道，付款人在这笔交易前有没有可能会造成双重支付的交易。所有的交易都公开透明，全网节点共同监督和维护同一个账本，对交易的顺序达成单一共识，这样，收款人在每笔交易时，都需要多数节点认同此交易是最先收到的证据。

## 3. 时间戳服务器

本章节解决的是区块先后顺序问题。比特币系统平均每十分钟会创建一个区块，每个区块包含了多个交易。每个区块都会有一个哈希值，后一个区块会包含前一个区块的哈希值，两两相连形成了一条单向的区块链，因此，只要知道了某个区块的哈希值，就可以知道前一个和后一个区块是什么。需要明确一点的是，这里所说的时间戳并非是区块的生成时间而是区块哈希，因为比特币区块链允许出现在后面的区块生成时间比之前的区块早。

![timestamp](https://github.com/darcy-fzh/darcy-fzh.github.io/raw/master/screenshots/timestamp.png)

## 4. 工作量证明

我们已经知道，比特币系统实际上就是一个数字账本，每个节点都会同步和维护同一个账本，那么问题来了，谁可以拥有记账权呢？为此中本聪引入了工作量证明（Proof of Work，简称PoW）巧妙了解决了这一问题。 

PoW就是让节点消耗CPU算力计算一个哈希值，并且比目标值小，计算的复杂程度随着目标值减少呈指数增长，但是验证只需执行一次哈希即可。对比特币有了解的读者们可能已经发现了，计算哈希值其实就是常说的“矿工挖矿”，”矿工“也是区块链网络中的一个节点，谁最先计算出正确的哈希值，谁就能获得记账权。

工作量证明解决了如何确定投票方式的问题。如果多数是按照IP地址投票来决定，那么攻击者就可以通过获得大量IP地址进行破坏，成本很小。而工作量证明本质上是按照CPU投票的，攻击者如果想篡改区块，那么就需要耗费CPU算力重新改变当前区块和之后所有的区块。而与此同时，如果诚实节点的算法超过攻击者算力，诚实的区块链就会增长得最快且超过攻击者生成的链。工作量证明机制确保了篡改区块链的成本要远远大于获得的收益，而遵循游戏法则就可以得到丰厚的奖励，这也是为什么比特币从问世以来，从来没有出现过一次错误的重要原因。

同时，中本聪还考虑了摩尔定律，为了抵消硬件速度的增加，工作量证明的难度将由移动平均法来确定每个小时生成区块的平均数，如果区块生成得过快， 那么生成的难度就会增加。

这里我们可以顺便聊一下量子计算机。有种观点认为当量子计算机问世后，区块链就不再有意义了，因为量子计算机的速度可以在很短时间内破解加密算法。的确，量子计算的影响是世界性的，会威胁到所有人的银行账户、线上交易、数据存储等。但同时我们也可以清楚地看到，量子计算技术还处于非常早期的阶段，Mark Webber等人在[这篇论文](https://avs.scitation.org/doi/10.1116/5.0073075)里提到，要想在1个小时内有效破解比特币交易密钥，需要大概3.17亿个量子位，而现在报道的最先进的IBM量子计算机也只有127个量子位。

区块链技术也在不断地发展进步，量子计算技术还需要很长的时间才有可能撼动现代加密算法。

## 5. 网络

运行比特币网络需要6个步骤：
1. 新交易向所有节点广播
2. 每个节点将新交易收集到一个区块
3. 每个节点为它的区块寻找工作量证明
4. 当一个节点找到了工作量证明，就向所有节点广播这个区块
5. 节点只有在区块内所有交易都是有效的且之前没有双重支付的情况下接受这个区块
6. 节点使用这个区块的哈希值作为上一个区块的哈希值记录在新区块中，表示接受了这个区块

节点总是认为最长的链是正确的并持续维护它，如果两个节点同时广播了不同的下一个区块，有些节点可能先收到其中一个，而其他节点先收到另一个。在这种情况下，节点基于收到的第一个区块工作，但是也保存另一个分支防止它变成更长的链。当下一个工作量证明被找到后僵局就会被打破从而其中一个分支变得更长，在另一个分支上工作的节点将切换到更长的链上。

新交易不必广播到所有节点， 只要到达部分节点，不久就会打包进区块。区块广播也能容忍一定程度的信息丢失，如果一个节点没有收到某个区块，它将在收到下一个区块时发现它丢失了一个区块然后去请求这个区块。

## 6. 激励

我们已经知道，比特币系统需要诚实节点通过工作量证明完成复杂计算，达成共识。而节点完成PoW需要耗费大量的成本，如果没有奖励机制，那么没有节点愿意将区块进行打包，整个比特币系统也将无法运转。我们约定，区块中的第一笔交易是特殊交易，专门用于奖励给区块的创建者，也就是“矿工”，同时矿工可以将比特币在市场中进行流通。当固定量的比特币全部进入了流通领域，激励将变成只含有交易费，这样可以避免通货膨胀。

激励机制可以鼓励节点保持诚实，因为攻击者会发现遵守规则比破坏系统获得的收益更大，整个系统便会保持安全稳健。






